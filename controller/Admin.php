<?php

/**
 *Класс на входе получает метод и обрабатывает входные данные, передает в базу и анализирует ответ,
 *  в случае верного ответа из базы загружает страницу для зарегистрированных пользователей
 * в противном случае загружает страницу авторизации
 */

class Admin{
/**
 * вызываем метод проверки  пользователя на предмет регистрации
 */
private $count;    
    function verify(){
 //echo 'In isUser()' ;
     /*проверяем массивы POST[] и GET[]*/   
         if(isset($_POST['user']) & isset($_POST['password'])
             & !empty($_POST['user']) & !empty($_POST['password'])){
/*Проверяем содержимое массива POST[] на предмет наличия непозволительных символов*/   
        $name = htmlspecialchars($_POST['user']);
        $name = trim($name);
        $password = htmlspecialchars($_POST['password']);
        $pasword = trim($password);
//echo 'name -'.$name.'  password - '.$password;        
        $db = new DB_connect;
        $is_us = $db->is_user($name, $password);
        
                if($is_us){
                    require'view/secret_page.php';
                    return true;
                }else{
           /*Если входные данные не верны то занести IP в базу и начать */         
                    ob_start();
                    $msg = 'Неверный логин или пароль';
                    require'view/message.php';
                    $message = ob_get_contents();
                    require'view/login_page.php';
                    return false;
                }
                
       /*Если массив POST[] пустой то снова загрузить форму с предупреждающим сообщением */         
        }else{
            
             ob_start();
            $msg = 'Для входа в админку заполните форму.Поля не должны быть пустыми';
             require'view/message.php';
            $message = ob_get_contents();
            ob_end_flush(); 
            
        require'view/login_page.php';
        }
        
    }
 
/**
 * метод регистрации пользователей
 * */
    function registration(){
         /*Проверяем содержимое массива POST[] на предмет наличия непозволительных символов*/   
        $name = htmlspecialchars($_POST['user']);
        $name = trim($name);
        $password = htmlspecialchars($_POST['password']);
        $pasword = trim($password);
 //echo 'name -'.$name.'  password - '.$password;           
        $db = new DB_connect;
    /*есть ли пользователь в базе*/  
         If($db->is_user($name, $password)){
         
             ob_start();
             $msg ='Пользователь с такими данными уже зарегистрирован';
             require'view/message.php';
   // echo $msg;         
             $message = ob_get_contents();
             ob_end_flush(); 
             require'view/login_page.php';     
             return;
         }  
         
//foreach($_POST as $k => $v)   echo $k.' - '.$v.'<br>';
    /**/       
        $registr = $db->user_input($name, $password);
        if($registr){
             ob_start();
             $msg ='Данные успешно внесены, можно вводить и входить..';
             require'view/message.php';
             $message = ob_get_contents();
             ob_end_flush(); 
             require'view/login_page.php';
        }else{
            echo'Неудача, не удалось внести данные';
        }
        return $registr;
    }
    
  /*обращаемся к базе данны для обновления количества попыток обращения*/
    function protection($num){
      
        
    }
    
}