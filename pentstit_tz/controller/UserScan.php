<?php

/**
 *Класс на входе получает метод и обрабатывает входные данные, передает в базу и анализирует ответ,
 *  в случае верного ответа из базы загружает страницу для зарегистрированных пользователей
 * в противном случае загружает страницу авторизации
 */

class UserScan{

/**
 * вызываем метод проверки  пользователя на предмет регистрации
 */
    function verify(){
 //echo 'In isUser()'       ;
     /*Проверяем содержимое массива POST[] на предмет наличия непозволительных символов*/   
        $name = htmlspecialchars($_POST['user']);
        $name = trim($name);
        $password = htmlspecialchars($_POST['password']);
        $pasword = trim($password);
        $db = new DB_connect;
        $is_us = $db->is_user($name, $password);
        if($is_us){
            //echo'Удача!!';
            require'view/secret_page.php';
        }else{
           // echo'Неудача';
            require'view/login_page.php';
        }
    }
 
/**
 * метод регистрации пользователей
 * */
    function registration(){
         /*Проверяем содержимое массива POST[] на предмет наличия непозволительных символов*/   
        $name = htmlspecialchars($_POST['user']);
        $name = trim($name);
        $password = htmlspecialchars($_POST['password']);
        $pasword = trim($password);
        $db = new DB_connect;
    /*есть ли пользователь в базе*/  
         If($db->is_user($name, $password)){
         
             ob_start();
             $msg ='Пользователь с такими данными уже зарегестрирован';
             require'view/message.php';
   // echo $msg;         
             $message = ob_get_contents();
             ob_end_flush(); 
             require'view/login_page.php';     
             return;
         }  
    /**/       
        $registr = $db->user_input($name, $password);
        if($registr){
             ob_start();
             $msg ='Данные успешно внесены, можно вводить и входить..';
             require'view/message.php';
             $message = ob_get_contents();
             ob_end_flush(); 
             require'view/login_page.php';
        }else{
            echo'Неудача, не удалось внести данные';
        }
        return $registr;
    }
    
  /*обращаемся к базе данны для обновления количества попыток обращения*/
    function protection($num){
      
        
    }
    
}