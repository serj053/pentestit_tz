<?php
//echo 'In index.php<br>';
//echo isset($_GET['mth'])?$_GET['mth']:'нет данных в GET[]'.'<br>';
//echo'boolean -  '.$_GET['mth'] == 'mth';
/* *
Точка входа , вызывается объект контроллера для проверки массива POST[]
 * для анализа его содержимого
 */

/**
 * Загрузчик  для загрузки классов* /
 */
  function __autoload($class){
        $directories = array('controller/','model/');
        foreach($directories as $directory){
        $file = $directory.$class.'.php';
            if(file_exists($file) && is_readable($file)){
                    require $file;
                    return;
                    }
                }		
          }
    
    if(isset($_POST['user']) & isset($_POST['password'])
             & !empty($_POST['user']) & !empty($_POST['password'])){
        /*определяем используемый метод для передачи объекту*/
         if(isset($_GET['mth']) && ($_GET['mth'] ==='verify' || $_GET['mth'] === 'registration')){
             $method = $_GET['mth'];
           //  echo '$method = '.$method;
         }else{
             die('А вот не надо взламывать код!');
         }
        
        //создаем объект контролирующий входные данные и вызываем метод
        $contr = new UserScan;
        $user = $contr->$method();
               
    }else{
        //если страница загружается не первый раз и поля пустые то вывести сообщение
        if(isset($_GET['mth'])){
            ob_start();
            $msg = 'Поля не должны быть пустыми';
             require'view/message.php';
            $message = ob_get_contents();
            ob_end_flush();        
        }
           require'view/login_page.php';
    }